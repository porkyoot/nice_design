/* Quasar Component Overrides to match Nice Design System */

/* Define layer order - our overrides come last */
@layer quasar-base, nice-design-overrides;

@layer nice-design-overrides {

    /* --- Global Brand Override --- */
    :root {
        --q-primary: var(--nd-primary) !important;
        --q-secondary: var(--nd-secondary) !important;
    }

    /* --- Color Mapping --- */
    .text-primary {
        color: var(--nd-primary) !important;
    }

    .bg-primary {
        background-color: var(--nd-primary) !important;
    }

    .text-secondary {
        color: var(--nd-secondary) !important;
    }

    .bg-secondary {
        background-color: var(--nd-secondary) !important;
    }

    /* --- Button Overrides --- */
    /* Ensure button icons use primary accent by default */
    .q-btn .q-icon {
        color: var(--nd-primary) !important;
    }

    /* Primary button icons should match on-primary color */
    .q-btn--unelevated .q-icon,
    .-nd-c-btn--primary .q-icon {
        color: var(--nd-on-primary) !important;
    }

    /* Secondary button icons should match on-secondary color */
    .-nd-c-btn--secondary .q-icon {
        color: var(--nd-on-secondary) !important;
    }

    /* Ghost/Outline button icons use primary accent */
    .q-btn--outline .q-icon,
    .-nd-c-btn--ghost .q-icon {
        color: var(--nd-primary) !important;
    }

    /* Button text color defaults */
    .q-btn__content {
        color: inherit !important;
    }

    /* Button text colors by variant */
    .q-btn--unelevated,
    .-nd-c-btn--primary {
        color: var(--nd-on-primary) !important;
    }

    .-nd-c-btn--secondary {
        color: var(--nd-on-secondary) !important;
    }

    .q-btn--outline,
    .-nd-c-btn--ghost,
    .q-btn--flat {
        color: var(--nd-primary) !important;
    }

    /* Outline button borders must use accent color */
    .q-btn--outline::before,
    .q-btn.q-btn--outline::before,
    .-nd-c-btn--ghost::before {
        border: 2px solid var(--nd-primary) !important;
    }

    /* Override Quasar's default border color for outline buttons */
    .q-btn--outline.text-primary::before {
        border-color: var(--nd-primary) !important;
    }

    /* Ensure any button with text-primary uses our accent color */
    .q-btn.text-primary,
    .q-btn.text-primary .q-btn__content,
    .q-btn.text-primary .q-icon {
        color: var(--nd-primary) !important;
    }

    /* Button interaction overlays - use themed colors */
    /* Focus helper (subtle overlay on keyboard focus) */
    .q-btn .q-focus-helper {
        background: currentColor !important;
        opacity: 0 !important;
    }

    .q-btn:focus .q-focus-helper {
        opacity: 0.12 !important;
    }

    /* Hover overlay */
    .q-btn:hover .q-focus-helper {
        opacity: 0.08 !important;
    }

    /* Active/Pressed state overlay */
    .q-btn:active .q-focus-helper,
    .q-btn--active .q-focus-helper {
        opacity: 0.16 !important;
    }

    /* Ripple effect - use themed primary color */
    .q-ripple {
        background: var(--nd-primary) !important;
        opacity: 0.3 !important;
    }

    /* Ripple on primary buttons should use on-primary color */
    .q-btn--unelevated .q-ripple,
    .-nd-c-btn--primary .q-ripple {
        background: var(--nd-on-primary) !important;
        opacity: 0.25 !important;
    }

    /* Ripple on secondary buttons */
    .-nd-c-btn--secondary .q-ripple {
        background: var(--nd-on-secondary) !important;
        opacity: 0.25 !important;
    }

    /* Ensure disabled buttons are visually distinct */
    .q-btn--disabled {
        opacity: 0.4 !important;
    }

    .q-btn--disabled .q-icon,
    .q-btn--disabled .q-btn__content {
        color: var(--nd-content-muted) !important;
    }

    /* --- Slider Overrides --- */
    /* Apply accent color as DEFAULT only - allow color prop to override */
    /* NO !important so that inline color styles take precedence */

    /* Active selection uses accent color by default */
    .q-slider__selection {
        background: var(--nd-primary);
    }

    /* Thumb/handle uses accent color by default */
    .q-slider__thumb {
        color: var(--nd-primary);
    }

    .q-slider__thumb-shape {
        background-color: currentColor;
        border-radius: var(--nd-radius-full);
    }

    /* Force slider label (tooltip) to use themed colors */
    .q-slider__label {
        background-color: var(--nd-primary) !important;
        color: var(--nd-on-primary) !important;
    }

    /* Fix: Override the inner text container that was showing beige */
    .q-slider__label .q-slider__text-container {
        background-color: transparent !important;
        color: inherit !important;
    }

    /* For sliders with color="primary", force the primary color to use our accent */
    .q-slider--primary .q-slider__thumb {
        color: var(--nd-primary);
    }

    .q-slider--primary .q-slider__selection {
        background: var(--nd-primary);
    }

    .q-slider--primary .q-slider__label {
        background-color: var(--nd-primary) !important;
    }

    /* Track background - make it visible with themed color */
    .q-slider__track {
        background-color: color-mix(in srgb, var(--nd-content-main), transparent 85%) !important;
        opacity: 1 !important;
    }

    /* Track container background */
    .q-slider__track-container {
        background-color: transparent;
    }

    .q-slider__marker-labels {
        color: var(--nd-content-main) !important;
    }

    /* --- Select Field Active/Focus State --- */
    /* Cover all variants: outlined, standout, filled */
    .q-field-highlighted .q-field__control,
    .q-field--outlined.q-field-highlighted .q-field__control,
    .q-field--standout.q-field-highlighted .q-field__control,
    .q-field--filled.q-field-highlighted .q-field__control {
        background: var(--nd-primary) !important;
    }

    .q-field-highlighted .q-field__native,
    .q-field-highlighted .q-field__label,
    .q-field-highlighted .q-icon,
    .q-field--outlined.q-field-highlighted .q-field__native,
    .q-field--outlined.q-field-highlighted .q-field__label,
    .q-field--outlined.q-field-highlighted .q-icon,
    .q-field--standout.q-field-highlighted .q-field__native,
    .q-field--standout.q-field-highlighted .q-field__label,
    .q-field--standout.q-field-highlighted .q-icon,
    .q-field--filled.q-field-highlighted .q-field__native,
    .q-field--filled.q-field-highlighted .q-field__label,
    .q-field--filled.q-field-highlighted .q-icon {
        color: var(--nd-on-primary) !important;
    }

    /* Border color for highlighted state */
    .q-field-highlighted .q-field__control:before,
    .q-field-highlighted .q-field__control:after,
    .q-field--outlined.q-field-highlighted .q-field__control:before,
    .q-field--outlined.q-field-highlighted .q-field__control:after {
        border-color: var(--nd-primary) !important;
    }

    /* --- Dialogs & Popups --- */
    /* Target cards or generic divs inside dialogs */
    .q-dialog__inner>div,
    .q-dialog__inner>.q-card {
        background-color: var(--nd-surface-layer) !important;
        border-radius: var(--nd-radius-lg) !important;
        border: var(--nd-border-sm) solid color-mix(in srgb, var(--nd-highlight), transparent 90%) !important;
        box-shadow: var(--nd-shadow-xl) !important;
        color: var(--nd-content-main) !important;
        overflow: hidden;
    }

    .q-dialog__backdrop {
        background: rgba(var(--nd-shadow-color), 0.4) !important;
        backdrop-filter: blur(2px);
    }

    /* --- Notifications (Toasts) --- */
    .q-notification {
        background-color: var(--nd-surface-overlay) !important;
        color: var(--nd-content-main) !important;
        border-radius: var(--nd-radius-md) !important;
        box-shadow: var(--nd-shadow-lg) !important;
        border: var(--nd-border-sm) solid color-mix(in srgb, var(--nd-highlight), transparent 80%) !important;
        padding: var(--nd-space-sm) var(--nd-space-md) !important;
        min-width: 300px;
    }

    .q-notification__message {
        font-family: var(--nd-font-main) !important;
        font-weight: 500 !important;
    }

    .q-notification__caption {
        color: var(--nd-content-muted) !important;
        opacity: 0.8;
    }

    /* Indicator bars for notification types */
    .q-notification--positive {
        border-left: 4px solid var(--nd-status-success) !important;
    }

    .q-notification--negative {
        border-left: 4px solid var(--nd-status-error) !important;
    }

    .q-notification--warning {
        border-left: 4px solid var(--nd-status-warning) !important;
    }

    .q-notification--info {
        border-left: 4px solid var(--nd-status-info) !important;
    }

    /* Notifications (Toasts) Inner Content */
    .q-notification__content {
        display: flex !important;
        align-items: center !important;
        gap: var(--nd-space-md) !important;
        /* Increased gap */
    }

    /* Notification Icons */
    .q-notification__icon {
        font-size: 24px !important;
        margin: 0 !important;
        min-width: 24px;
    }

    .q-notification--positive .q-notification__icon {
        color: var(--nd-status-success) !important;
    }

    .q-notification--negative .q-notification__icon {
        color: var(--nd-status-error) !important;
    }

    .q-notification--warning .q-notification__icon {
        color: var(--nd-status-warning) !important;
    }

    .q-notification--info .q-notification__icon {
        color: var(--nd-status-info) !important;
    }

    /* --- Tooltips --- */
    .q-tooltip {
        background-color: var(--nd-surface-overlay) !important;
        color: var(--nd-content-main) !important;
        border: var(--nd-border-sm) solid var(--nd-primary) !important;
        border-radius: var(--nd-radius-sm) !important;
        font-size: 0.75rem !important;
        box-shadow: var(--nd-shadow-sm) !important;
        padding: var(--nd-space-xs) var(--nd-space-sm) !important;
    }

    /* --- Menu (Ensure global menu items look right if not using nice.menu_item) --- */
    .q-menu {
        background-color: var(--nd-surface-layer) !important;
        border: var(--nd-border-sm) solid color-mix(in srgb, var(--nd-highlight), transparent 90%) !important;
        border-radius: var(--nd-radius-md) !important;
        box-shadow: var(--nd-shadow-lg) !important;
        color: var(--nd-content-main) !important;
    }

    .q-menu .q-item {
        color: var(--nd-content-main) !important;
        font-family: var(--nd-font-main) !important;
    }

    .q-menu .q-item:hover {
        background-color: color-mix(in srgb, var(--nd-primary), transparent 90%) !important;
    }

    /* --- NiceGUI Specific Popups --- */
    .nicegui-error-popup {
        display: flex !important;
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: var(--nd-space-xs) !important;
        background-color: var(--nd-content-muted) !important;
        color: var(--nd-surface-base) !important;
        border-radius: var(--nd-radius-md) !important;
        box-shadow: var(--nd-shadow-lg) !important;
        border: var(--nd-border-sm) solid var(--nd-status-warning) !important;
        padding: var(--nd-space-md) var(--nd-space-lg) !important;
        padding-left: 3.5rem !important;
        /* Larger gap for the warning icon */
        font-family: var(--nd-font-main) !important;
        font-weight: 600 !important;
        z-index: 9999 !important;
    }

    .nicegui-error-popup span:first-child {
        margin-top: 2px;
        /* Subtle vertical adjustment for the first line */
    }

    .nicegui-error-popup span {
        display: block;
    }

}

/* End @layer nice-design-overrides */

/* ============================================
   CRITICAL OVERRIDES - Maximum Specificity
   These sit outside layers to ensure they win
   ============================================ */

/* Force all Quasar primary references to use our accent color */
:root {
    --q-primary: var(--nd-primary) !important;
    --q-secondary: var(--nd-secondary) !important;
}

/* Eliminate any blue from text-primary utility */
.text-primary,
button.text-primary,
.q-btn.text-primary {
    color: var(--nd-primary) !important;
}

/* Force outline button borders to use accent color */
.q-btn--outline::before {
    border-color: var(--nd-primary) !important;
}

/* Ensure outline button text uses accent color */
.q-btn--outline {
    color: var(--nd-primary) !important;
}

.q-btn--outline .q-icon {
    color: var(--nd-primary) !important;
}

/* Override any lingering Quasar color utilities */
.bg-primary {
    background-color: var(--nd-primary) !important;
}

.text-secondary {
    color: var(--nd-secondary) !important;
}

.bg-secondary {
    background-color: var(--nd-secondary) !important;
}

/* --- Color Mapping Utilities (Critical Focus) --- */
/* We move these outside the layer to win vs Quasar's defaults */
.text-primary,
button.text-primary,
.q-btn.text-primary,
.q-slider--primary .q-slider__thumb,
.q-slider__thumb.text-primary {
    color: var(--nd-primary) !important;
}

.bg-primary,
.q-slider--primary .q-slider__selection,
.q-slider__selection.bg-primary {
    background-color: var(--nd-primary) !important;
}

.text-secondary,
.q-slider__thumb.text-secondary {
    color: var(--nd-secondary) !important;
}

.bg-secondary,
.q-slider__selection.bg-secondary {
    background-color: var(--nd-secondary) !important;
}

/* Critical slider overrides - fallback to primary accent if no specific color is detected */
.q-slider__thumb:not([class*="text-"]) {
    color: var(--nd-primary) !important;
}

.q-slider__selection:not([class*="bg-"]) {
    background-color: var(--nd-primary) !important;
}

/* Force slider tooltip/label and its arrowhead to use themed colors and dynamic roundness */
.q-slider__label {
    background-color: var(--nd-primary) !important;
    /* Default fallback */
    color: var(--nd-on-primary) !important;
    border-radius: var(--nd-radius-md) !important;
    /* Dynamically follow theme roundness */
}

/* Tooltip arrowhead (triangle) color sync */
.q-slider__pin:before {
    border-top-color: var(--nd-primary) !important;
}

/* Match pin arrowhead to the thumb color if not primary */
.q-slider__thumb.text-secondary~.q-slider__pin:before,
.q-slider__thumb.text-secondary .q-slider__pin:before {
    border-top-color: var(--nd-secondary) !important;
}

/* Ensure the arrowhead follows the current accent even if changed dynamically */
.q-slider__thumb.text-primary~.q-slider__pin:before,
.q-slider__thumb.text-primary .q-slider__pin:before {
    border-top-color: var(--nd-primary) !important;
}

/* Handle colored sliders: pin arrowhead should inherit or use primary as fallback */
.q-slider:not(.q-slider--primary) .q-slider__pin:before {
    border-top-color: inherit !important;
}

/* Ensure the background follows the slider color if not primary */
.q-slider:not(.q-slider--primary) .q-slider__label {
    background-color: inherit !important;
    color: inherit !important;
}

/* Critical fix: Make the inner text container transparent to show our rounding and background */
.q-slider__label .q-slider__text-container {
    background-color: transparent !important;
    color: inherit !important;
    border-radius: inherit !important;
}

/* Ensure the thumb shape follows the thumb color AND roundness */
.q-slider__thumb-shape {
    background-color: currentColor !important;
    fill: currentColor !important;
    border-radius: var(--nd-radius-md) !important;
    /* Dynamically follow theme roundness */
}

/* If it's an SVG handle, we hide the hardcoded path to let our CSS bg + radius define the shape */
.q-slider__thumb-shape svg path {
    display: none !important;
}

/* If the SVG itself has the class */
svg.q-slider__thumb-shape path {
    display: none !important;
}